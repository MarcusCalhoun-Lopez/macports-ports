# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem                              1.0
PortGroup           gcc_build           1.0

name                gcc-devel
version             14-20240303
subport ${name}     { revision 0 }
subport lib${name}  { revision 0 }
epoch               5

platforms           {darwin >= 10}

long_description    This is an !experimental!, !BETA! version \
                    built from GCC snapshots. The GNU compiler collection,

checksums           rmd160  daa8953ee2718a28b7c67170fce2300d29e4ebee \
                    sha256  c432cf29aa1f0f362533a868e9c89ed0b21df50bc438ec0d77ba2a2a31571f00 \
                    size    87667912

# snapshots and RC candidates
master_sites        https://mirror.koddos.net/gcc/snapshots/${version}/ \
                    https://bigsearcher.com/mirrors/gcc/snapshots/${version}/ \
                    ftp://ftp.funet.fi/pub/mirrors/sources.redhat.com/pub/gcc/snapshots/${version}/ \
                    ftp://gcc.gnu.org/pub/gcc/snapshots/${version}/

if { ${os.platform} eq "darwin" } {
    # GCC fixinc work-around for sys/ucred.h on OSX10.14.4 no longer seems to work ???
    if { ${os.major} == 18 } {
        patchfiles-append  patch-OSX10.14-ucred-atomic-define.diff
    }
}

# see https://gcc.gnu.org/bugzilla/show_bug.cgi?id=115416
patchfiles-append       patch-disable-sys-header-missing-abort.diff

post-destroot {
    # allow this subport to satisfy `path:share/doc/libgcc/README:libgcc` dependency
    xinstall -d ${destroot}${prefix}/share/doc/${name}
    system  "echo 'libgcc runtime is provided by ${subport}' > ${destroot}${prefix}/share/doc/libgcc/README"
}

# see https://trac.macports.org/ticket/29067
# see https://trac.macports.org/ticket/29104
# see https://trac.macports.org/ticket/47996
# see https://trac.macports.org/ticket/58493
# see https://build.macports.org/builders/ports-10.13_x86_64-builder/builds/105513/steps/install-port/logs/stdio
#     c++/v1/functional:1408:2: error: no member named 'fancy_abort' in namespace 'std::__1'; did you mean simply 'fancy_abort'?
compiler.blacklist-append   {clang < 800} gcc-4.0 *gcc-4.2 {llvm-gcc-4.2 < 2336.1} {macports-clang-3.[4-7]} {clang < 1001}

livecheck.url       ftp://gcc.gnu.org/pub/gcc/snapshots/
livecheck.regex     LATEST-${gcc.major} -> (${gcc.major}-\[0-9\]+)
