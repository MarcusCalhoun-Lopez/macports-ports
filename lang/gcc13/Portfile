# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem                              1.0
PortGroup           gcc_build           1.0

name                gcc13
version             13.2.0
subport ${name}     { revision 0 }
subport lib${name}  { revision 0 }

platforms           {darwin >= 10}

checksums           rmd160  a6d646ed9765f973d3f63ef560edf4a50cf686c3 \
                    sha256  e275e76442a6067341a27f04c5c6b83d8613144004c0413528863dc6b5c743da \
                    size    87858592

if { ${os.platform} eq "darwin" } {
    # Patch generated from https://github.com/iains/gcc-13-branch
    # git diff --no-prefix releases/gcc-13.1.0 gcc-13.1-darwin-r0
    patchfiles-append      patch-darwin-gcc-${version}.diff
    # Do not abort if 'system' headers in /opt/local/include/gcc are missing
    patchfiles-append      patch-disable-sys-header-missing-abort.diff
    # GCC fixinc work-around for sys/ucred.h on OSX10.14.4 no longer seems to work ???
    if { ${os.major} == 18 } {
        patchfiles-append  patch-OSX10.14-ucred-atomic-define.diff
    }
}

# see https://gcc.gnu.org/bugzilla/show_bug.cgi?id=111632
patchfiles-append   patch-avoid-over-poisoning.diff

# see https://trac.macports.org/ticket/29067
# see https://trac.macports.org/ticket/29104
# see https://trac.macports.org/ticket/47996
# see https://trac.macports.org/ticket/58493
# see https://build.macports.org/builders/ports-10.13_x86_64-builder/builds/105513/steps/install-port/logs/stdio
#     c++/v1/functional:1408:2: error: no member named 'fancy_abort' in namespace 'std::__1'; did you mean simply 'fancy_abort'?
compiler.blacklist-append   {clang < 800} gcc-4.0 *gcc-4.2 {llvm-gcc-4.2 < 2336.1} {macports-clang-3.[4-7]} {clang < 1001}
