# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem                              1.0
PortGroup           gcc_build           1.0
PortGroup           xcode_workaround    1.0

name                gcc7
version             7.5.0
subport ${name}     { revision 4 }
subport lib${name}  { revision 1 }
epoch               3

platforms           {darwin < 15}

checksums           rmd160  91d46ec088badec75f41a2ad2a0ba228a6715107 \
                    sha256  b81946e7f01f90528a1f7352ab08cc602b9ccc05d4e44da4bd501c5a189ee661 \
                    size    62783088

if { ${libgcc.is_full} } {
    libgcc.depends_lib  port:zlib
} else {
    libgcc.keep         libgfortran.4.dylib \
                        libasan.4.dylib \
                        libubsan.0.dylib \
                        libcilkrts.5.dylib
    libgcc.depends_lib
}

if { ${configure.build_arch} eq "i386" && ${os.major} >= 10 } {
    # TODO: does this work with universal?
    # fix no-pie clang bug bootstrapping gcc on i386
    # https://trac.macports.org/ticket/63161
    patchfiles-append   patch-gcc7-i686-clang-bootstrap-fix.diff
}

# Work around parallel building issue on APFS
# https://gcc.gnu.org/bugzilla/show_bug.cgi?id=81797
patchfiles-append   notparallel-install-headers.patch

platform darwin 8 i386 {
    patchfiles-append   patch-gcc7-tiger-intel.diff
}

# see http://trac.macports.org/ticket/29067
# see http://trac.macports.org/ticket/29104
# see https://trac.macports.org/ticket/47996
compiler.blacklist-append   gcc-4.0 {llvm-gcc-4.2 < 2336.1} {clang < 300}
